# _Craft Kitchen Kneading_ (Крафтовый Кухонный Замес) - _Backend_

## Разработка проекта

### 1. Установка зависимостей:

```bash
pip install poetry
poetry install
```

### 2. Настройка базы данных

   ```bash
   alembic upgrade head
   ```

> При изменении имени базы данных в `main.env` - необходимо изменить настройки в `alembic.ini`

### 3. Запуск сервера для разработки:

```bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### Основные компоненты:

* main.py - основной файл приложения с FastAPI
* База данных SQLite (health.db)
* Миграции Alembic в директории migrations/
* Poetry для управления зависимостями (pyproject.toml)

Конфигурация находится в:

* main.env - основные настройки
* alembic.ini - настройки миграций

После запуска API будет доступно по адресу http://localhost:8000

Важные замечания:

1. Необходим Python 3.10+
2. База данных SQLite создается автоматически при применении миграций
3. При первом запуске создается root пользователь из настроек в main.env

Это базовый набор инструкций для локальной разработки. При необходимости можно расширить конфигурацию для продакшена.

## Описание проекта

_Backend_-сервис для работы с рецептами, построенный на _FastAPI_ с использованием _SQLAlchemy_ для работы с базой данных.

## Архитектура

Проект имеет модульную архитектуру и состоит из следующих основных сервисов:

* _Auth Service (/services/auth)_ - Сервис аутентификации и авторизации
* _Personality Service (/services/personality)_ - Управление пользователями, группами и ролями
* _Health Service (/core)_ - Базовый сервис для проверки работоспособности

## Потенциальное разделение на микросервисы

Текущая архитектура позволяет легко выделить следующие микросервисы:

* _Auth Service_
* _User Service_
* _Recipe Service_ (планируется)
* _Notify Service_ (планируется)
* _Chat Service_ (планируется)
* _Consumer Service_ (планируется)
* _Producer Service_ (планируется)
* _Task Service_ (планируется)
* _User-data Service_ (планируется)
* _Analyzer Service_ (планируется)

Наличие такого количество сервисов потребует реализации сервисной шины, которую можно реализовать через _RabbitMQ_

## Настройка базы данных

1. База данных _SQLite_ используется по умолчанию
2. Конфигурация в `main.env`:

    ```env
    DB_NAME=health.db
    DB_URL=sqlite+aiosqlite:///health.db
    ```

3. Миграции управляются через _Alembic_:

   ```bash
   python makemigrations.py # создание миграций
   alembic upgrade head # применение миграций
   ```

## Переменные окружения

Основные переменные окружения (`main.env`):

   ```env
   DB_NAME=health.db
   DB_URL=sqlite+aiosqlite:///health.db
   
   ROOT_USERNAME=root
   ROOT_PASSWORD=root_password
   
   SERVICE_BASE_URL_AUTH=http://127.0.0.1:8000
   SERVICE_BASE_URL_USER=http://127.0.0.1:8000
   ```

## Планируемые улучшения

### 1. Контейнеризация

* _Docker_ контейнеры для каждого сервиса
* _Docker_ Compose для локальной разработки

### 2. _CI/CD_:

* Автоматизация тестирования
* Автоматическое развертывание

### 3. Тестирование:

* _Unit_ тесты
* Интеграционные тесты
* _API_ тесты

## Зависимости

Основные зависимости указаны в `pyproject.toml`, управление через _Poetry_.